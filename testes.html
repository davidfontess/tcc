<!DOCTYPE html>
<html>
<head>
    <title>Desenho com EaselJS</title>
    <script src="https://code.createjs.com/easeljs-0.8.2.min.js"></script>
</head>
<body>
    <div style="display: flex;">
        <textarea id="codigo" style="width: 50%; height: 400px;"></textarea>
        <canvas id="canvas" width="400" height="400" style="border:1px solid black;"></canvas>
    </div>
    <button onclick="executarCodigo()">Executar</button>

    <script>
        const canvasSize = 400;
        const coordMax = 10;
        const step = canvasSize / (2 * coordMax);

        const stage = new createjs.Stage("canvas");

        const converterCoordenadas = (x, y) => [
            canvasSize / 2 + x * step,
            canvasSize / 2 - y * step
        ];

        const desenharPlanoCartesiano = () => {
            const eixo = new createjs.Shape();
            eixo.graphics.setStrokeStyle(1).beginStroke("black");

            // Eixo X
            eixo.graphics.moveTo(0, canvasSize / 2).lineTo(canvasSize, canvasSize / 2);
            // Eixo Y
            eixo.graphics.moveTo(canvasSize / 2, 0).lineTo(canvasSize / 2, canvasSize);

            stage.addChild(eixo);
        };

        class Figura {
            constructor(cor = "black") {
                this.cor = cor;
            }
            clone() {
                return Object.assign(Object.create(Object.getPrototypeOf(this)), this);
            }
        }

        class Linha extends Figura {
            constructor(x1, y1, x2, y2, cor = "black") {
                super(cor);
                this.x1 = x1;
                this.y1 = y1;
                this.x2 = x2;
                this.y2 = y2;
            }
        }

        class Polilinha extends Figura {
            constructor(pontos, cor = "black") {
                super(cor);
                this.pontos = pontos;
            }
        }

        class Poligono extends Figura {
            constructor(pontos, cor = "black") {
                super(cor);
                this.pontos = pontos;
            }
        }

        class Texto extends Figura {
            constructor(conteudo, x, y, tamanho = "12px", cor = "black") {
                super(cor);
                this.conteudo = conteudo;
                this.x = x;
                this.y = y;
                this.tamanho = tamanho;
            }
        }

        const linha = (x1, y1, x2, y2, cor = "black") => new Linha(x1, y1, x2, y2, cor);
        const polilinha = (pontos, cor = "black") => new Polilinha(pontos, cor);
        const poligono = (pontos, cor = "black") => new Poligono(pontos, cor);
        const texto = (conteudo, x, y, tamanho = "12px", cor = "black") => new Texto(conteudo, x, y, tamanho, cor);
		
		const rotacionar = (figura, angulo) => {
		const rad = (Math.PI / 180) * angulo; // Converte o ângulo para radianos

		// Calcula o centro da figura
		const calcularCentro = (pontos) => {
			let xTotal = 0, yTotal = 0;
			pontos.forEach(([x, y]) => {
				xTotal += x;
				yTotal += y;
			});
			return [xTotal / pontos.length, yTotal / pontos.length];
		};

		const rotacionarPonto = (x, y, cx, cy) => {
			const cos = Math.cos(rad);
			const sin = Math.sin(rad);
			return [
				cos * (x - cx) - sin * (y - cy) + cx,
				sin * (x - cx) + cos * (y - cy) + cy
			];
		};

		if (figura instanceof Linha) {
			const [cx, cy] = calcularCentro([[figura.x1, figura.y1], [figura.x2, figura.y2]]);
			[figura.x1, figura.y1] = rotacionarPonto(figura.x1, figura.y1, cx, cy);
			[figura.x2, figura.y2] = rotacionarPonto(figura.x2, figura.y2, cx, cy);
		} else if (figura instanceof Polilinha || figura instanceof Poligono) {
			const [cx, cy] = calcularCentro(figura.pontos);
			figura.pontos = figura.pontos.map(([x, y]) => rotacionarPonto(x, y, cx, cy));
		} else if (figura instanceof Texto) {
			[figura.x, figura.y] = rotacionarPonto(figura.x, figura.y, figura.x, figura.y);
		}
	};

        const desenhar = (figura) => {
            let shape = new createjs.Shape();

            if (figura instanceof Linha) {
                let [x1, y1] = converterCoordenadas(figura.x1, figura.y1);
                let [x2, y2] = converterCoordenadas(figura.x2, figura.y2);
                shape.graphics.setStrokeStyle(1).beginStroke(figura.cor);
                shape.graphics.moveTo(x1, y1).lineTo(x2, y2);
                shape.graphics.endStroke();
                stage.addChild(shape);
            } else if (figura instanceof Polilinha) {
                shape.graphics.setStrokeStyle(1).beginStroke(figura.cor);
                let [x0, y0] = converterCoordenadas(...figura.pontos[0]);
                shape.graphics.moveTo(x0, y0);

                figura.pontos.slice(1).forEach(p => {
                    let [x, y] = converterCoordenadas(...p);
                    shape.graphics.lineTo(x, y);
                });

                shape.graphics.endStroke();
                stage.addChild(shape);
            } else if (figura instanceof Poligono) {
                shape.graphics.beginFill(figura.cor);
                let [x0, y0] = converterCoordenadas(...figura.pontos[0]);
                shape.graphics.moveTo(x0, y0);

                figura.pontos.slice(1).forEach(p => {
                    let [x, y] = converterCoordenadas(...p);
                    shape.graphics.lineTo(x, y);
                });

                shape.graphics.closePath();
                shape.graphics.endFill();
                stage.addChild(shape);
            } else if (figura instanceof Texto) {
                let [x, y] = converterCoordenadas(figura.x, figura.y);
                let text = new createjs.Text(figura.conteudo, figura.tamanho + " Arial", figura.cor);
                text.x = x;
                text.y = y;
                stage.addChild(text);
            }

            stage.update();
        };

        desenharPlanoCartesiano();
        const meuPoligono = poligono([[-2,-2],[2,-2],[2,2],[-2,2]], "blue");
        const minhaLinha = linha(-2, -2, 10, 10);
		const minhaPolilinha = polilinha([[-3, -3], [0, 3], [3, -3]], "green");
        desenhar(texto("Olá, mundo!", 0, 0, "16px", "black"));
		rotacionar(minhaLinha,45);
		rotacionar(meuPoligono,45);
		rotacionar(minhaPolilinha,45);
		desenhar(minhaLinha);
		desenhar(meuPoligono);
		desenhar(minhaPolilinha);

    </script>
</body>
</html>
